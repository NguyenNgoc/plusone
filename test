#!/bin/sh

export basedir=$PWD

# compile lda code
cd lib/lda-c-dist; make || exit

# compile using ant
cd $basedir; ant -f build.xml || exit

# download test.data if it doesn't exist

if test ! -f /tmp/test.5000.data; then
   cd /tmp/
   wget http://inst.eecs.berkeley.edu/~darrenk/test.5000.data
   cd $basedir
fi

out_dir=experiment-$(date -u +%F.%T%Z)
mkdir $out_dir || exit
echo Output will go in $out_dir

args=\
"-Dplusone.testWordPercents=0.3,0.6 \
 -Dplusone.kValues=1,15 \
 -Dplusone.closestKValues=20,100 \
 -Dplusone.enableTest.lda=false \
 -Dplusone.enableTest.knnc=false \
 -Dplusone.enableTest.knn=false \
 -Dplusone.enableTest.knnrw=false \
 -Dplusone.enableTest.dtrw=true \
 -Dplusone.enableTest.baseline=true \
 -Dplusone.enableTest.baseline1=true \
 -Dplusone.outPath=$out_dir"

#java -agentlib:hprof=cpu=samples -Xmx6000m -cp Plusone.jar:lib/jars/ejml-0.17.jar plusone.Main /tmp/test.5000.data 0.8 0.3
#java -agentlib:hprof=heap=sites -Xmx128m -cp Plusone.jar:lib/jars/ejml-0.17.jar plusone.Main /tmp/test.5000.data 0.8 0.3
java -Xmx4096m -cp Plusone.jar:lib/jars/ejml-0.17.jar $args plusone.Main /tmp/test.5000.data 0.8 0.3
#java -Xmx4096m -cp Plusone.jar:lib/jars/ejml-0.17.jar plusone.Main toy.data 0.8 0.3
#java -Xmx4096m -cp Plusone.jar:lib/jars/ejml-0.17.jar plusone.Main /tmp/wiki.data 0.8 0.3
